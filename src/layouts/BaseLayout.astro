---
import "../styles/global.css";

interface Props {
  title?: string;
  description?: string;
  keywords?: string[];
  image?: string;
  type?: string;
}

const {
  title = "Álvaro Villena - Innovation Coach & Digital Product Builder",
  description = "Transformo ideas digitales en productos listos para vender. Especialista en Shape Up, landing pages de alto impacto y gerencia fraccional de innovación. Desde $19 USD.",
  keywords = [],
  image = "/assets/AlvaroAvatar.png",
  type = "website"
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, "https://alvarovillena.cl");
const socialImageURL = new URL(image, canonicalURL);

const defaultKeywords = [
  "álvaro villena",
  "innovation coach",
  "digital product builder",
  "shape up methodology",
  "emprendimiento digital",
  "startup coaching",
  "landing pages",
  "gerencia fraccional",
  "innovación empresarial",
  "producto digital",
  "MVP development",
  "coaching emprendedor",
  "transformación digital",
  "estrategia de negocio",
  "chile",
  "santiago",
  "coaching innovación",
  "asesoría empresarial",
  "desarrollo de productos",
  "validación de ideas"
];

const allKeywords = [...new Set([...defaultKeywords, ...keywords])];
const currentYear = new Date().getFullYear();
---

<!doctype html>
<html lang="es">
  <head>
    <!-- Google Tag Manager -->
    <script>
      (function(w,d,s,l,i){
        w[l]=w[l]||[];
        w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
        var f = d.getElementsByTagName(s)[0];
        var j = d.createElement(s);
        var dl = l!='dataLayer'?'&l='+l:'';
        j.async = true;
        j.src = 'https://www.googletagmanager.com/gtm.js?id='+i+dl;
        if (f && f.parentNode) {
          f.parentNode.insertBefore(j,f);
        }
      })(window,document,'script','dataLayer','GTM-PBTHC5VK');
    </script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icono.png" />
    <link rel="shortcut icon" type="image/png" href="/assets/icono.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icono.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/icono.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/icono.png" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Canonical and Generator -->
    <link rel="canonical" href={canonicalURL} />
    <meta name="generator" content={Astro.generator} />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <meta name="keywords" content={allKeywords.join(", ")} />
    <meta name="author" content="Álvaro Villena" />
    <meta name="copyright" content={`© ${currentYear} Álvaro Villena. Todos los derechos reservados.`} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={socialImageURL} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="Álvaro Villena - Innovation Coach & Digital Product Builder" />
    <meta property="og:locale" content="es_ES" />
    <meta property="og:site_name" content="Álvaro Villena" />
    <meta property="og:locale:alternate" content="en_US" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:site" content="@alvarovillena" />
    <meta property="twitter:creator" content="@alvarovillena" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={socialImageURL} />
    <meta property="twitter:image:alt" content="Álvaro Villena - Innovation Coach & Digital Product Builder" />

    <!-- Additional Meta Tags -->
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
    <meta name="googlebot" content="index, follow" />
    <meta name="theme-color" content="#2175a1" />
    <meta name="msapplication-TileColor" content="#2175a1" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Álvaro Villena" />
    
    <!-- Language and Region -->
    <meta name="language" content="Spanish" />
    <meta name="geo.region" content="CL" />
    <meta name="geo.placename" content="Santiago" />
    <meta name="geo.position" content="-33.4489;-70.6693" />
    <meta name="ICBM" content="-33.4489, -70.6693" />
    
    <!-- Additional SEO -->
    <meta name="revisit-after" content="7 days" />
    <meta name="distribution" content="global" />
    <meta name="rating" content="general" />
    <meta name="coverage" content="worldwide" />
    <meta name="target" content="all" />
    <meta name="classification" content="Business" />
    <meta name="category" content="Coaching & Consulting" />
    
    <!-- Performance and Security -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://www.googletagmanager.com" />
    <link rel="preconnect" href="https://calendly.com" />
    
    <!-- DNS Prefetch -->
    <link rel="dns-prefetch" href="//www.google-analytics.com" />
    <link rel="dns-prefetch" href="//www.googletagmanager.com" />
    <link rel="dns-prefetch" href="//calendly.com" />
    <link rel="dns-prefetch" href="//wa.me" />
    <link rel="dns-prefetch" href="//www.linkedin.com" />

    <!-- Structured Data / JSON-LD -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@graph": [
          {
            "@type": "Person",
            "@id": "https://alvarovillena.cl/#person",
            "name": "Álvaro Villena",
            "alternateName": "Alvaro Villena",
            "url": "https://alvarovillena.cl",
            "image": {
              "@type": "ImageObject",
              "url": "https://alvarovillena.cl/assets/AlvaroAvatar.png",
              "width": 400,
              "height": 400
            },
            "description": "Innovation Coach & Digital Product Builder. Especialista en Shape Up, landing pages de alto impacto y gerencia fraccional de innovación.",
            "jobTitle": "Innovation Coach & Digital Product Builder",
            "worksFor": {
              "@type": "Organization",
              "name": "Villelabs",
              "url": "https://alvarovillena.cl"
            },
            "sameAs": [
              "https://www.linkedin.com/in/alvarovillena/",
              "https://twitter.com/alvarovillena"
            ],
            "address": {
              "@type": "PostalAddress",
              "addressLocality": "Santiago",
              "addressRegion": "RM",
              "addressCountry": "CL"
            },
            "contactPoint": {
              "@type": "ContactPoint",
              "contactType": "customer service",
              "email": "hola@alvarovillena.cl",
              "telephone": "+56920115198",
              "availableLanguage": ["Spanish", "English"]
            },
            "knowsAbout": [
              "Shape Up Methodology",
              "Digital Product Development",
              "Startup Coaching",
              "Innovation Management",
              "Landing Page Optimization",
              "Business Strategy"
            ],
            "hasOfferCatalog": {
              "@type": "OfferCatalog",
              "name": "Servicios de Coaching e Innovación",
              "itemListElement": [
                {
                  "@type": "Offer",
                  "itemOffered": {
                    "@type": "Service",
                    "name": "E-book Interactivo Shape Up",
                    "description": "Guía paso a paso para dar forma a tu idea y llevarla al mercado en menos de 6 semanas.",
                    "price": "19",
                    "priceCurrency": "USD"
                  }
                },
                {
                  "@type": "Offer",
                  "itemOffered": {
                    "@type": "Service",
                    "name": "Landing Pages de Alto Impacto",
                    "description": "Landing page optimizada para ventas, con garantía de conversión en la primera semana.",
                    "price": "199",
                    "priceCurrency": "USD"
                  }
                },
                {
                  "@type": "Offer",
                  "itemOffered": {
                    "@type": "Service",
                    "name": "Asesoría Shape Up",
                    "description": "Te acompaño 1:1 a implementar Shape Up en tu proyecto digital.",
                    "price": "499",
                    "priceCurrency": "USD"
                  }
                },
                {
                  "@type": "Offer",
                  "itemOffered": {
                    "@type": "Service",
                    "name": "Gerencia Fraccional de Innovación",
                    "description": "Lidero tus proyectos de innovación sin necesidad de contratar un gerente full-time.",
                    "price": "1200",
                    "priceCurrency": "USD"
                  }
                }
              ]
            }
          },
          {
            "@type": "Organization",
            "@id": "https://alvarovillena.cl/#organization",
            "name": "Villelabs",
            "url": "https://alvarovillena.cl",
            "logo": "https://alvarovillena.cl/assets/icono.png",
            "description": "Empresa de coaching e innovación digital fundada por Álvaro Villena",
            "foundingDate": "2020",
            "founder": {
              "@type": "Person",
              "name": "Álvaro Villena"
            },
            "address": {
              "@type": "PostalAddress",
              "addressLocality": "Santiago",
              "addressRegion": "RM",
              "addressCountry": "CL"
            },
            "contactPoint": {
              "@type": "ContactPoint",
              "contactType": "customer service",
              "email": "hola@alvarovillena.cl"
            }
          },
          {
            "@type": "WebSite",
            "@id": "https://alvarovillena.cl/#website",
            "url": "https://alvarovillena.cl",
            "name": "Álvaro Villena - Innovation Coach",
            "description": "Sitio web oficial de Álvaro Villena, Innovation Coach & Digital Product Builder",
            "publisher": {
              "@id": "https://alvarovillena.cl/#organization"
            },
            "potentialAction": {
              "@type": "SearchAction",
              "target": "https://alvarovillena.cl/search?q={search_term_string}",
              "query-input": "required name=search_term_string"
            }
          }
        ]
      }
    </script>

    <!-- Remix Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />

    <!-- Social Media Links -->
    <link rel="me" href="https://www.linkedin.com/in/alvarovillena/" />
    <link rel="me" href="https://twitter.com/alvarovillena" />

    <!-- AOS Animate On Scroll CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" />
  </head>
  <body class="overflow-x-hidden relative">
    <!-- Animated Background -->
    <div class="fixed inset-0 -z-10" style="background: linear-gradient(135deg, #2175a1 0%, #3ca6dd 50%, #2175a1 100%);">
      <div class="absolute inset-0 opacity-20">
        <img 
          src="/assets/AnimatedBackgroundPattern.gif" 
          alt="Animated Background Pattern" 
          class="w-full h-full object-cover"
        />
      </div>
    </div>

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBTHC5VK"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <slot />

    <!-- AOS Animate On Scroll JS -->
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js" defer></script>
    <script is:inline>
      window.addEventListener('DOMContentLoaded', function () {
        if (window.AOS) {
          window.AOS.init({
            duration: 800,
            once: true
          });
        }
        
        // Intersection Observer for fade-in animations
        const observerOptions = {
          threshold: 0.1,
          rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('visible');
            }
          });
        }, observerOptions);

        // Observe all fade-in elements
        document.querySelectorAll('.fade-in').forEach(el => {
          observer.observe(el);
        });
        
        // Enhanced smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
              target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }
          });
        });
      });
    </script>
  </body>
</html> 